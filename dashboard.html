<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Dashboard</title>
   <style>
      /* Existing CSS styles here */

      /* New styles for screenshot upload and verification */
      .upload-container {
         margin-top: 20px;
      }
      .verify-button {
         background-color: #007bff;
         color: white;
         border: none;
         padding: 10px;
         border-radius: 5px;
         cursor: pointer;
         transition: background 0.3s;
         display: inline-block;
         margin-top: 10px;
      }
      .verify-button:hover {
         background-color: #0056b3;
      }
   </style>
</head>
<body>
   <!-- Existing dashboard HTML here -->

   <!-- Screenshot Upload and FreeFire UID Input -->
   <div class="dashboard-container">
      <div class="upload-container">
         <h3>Upload Screenshot and Verify FreeFire UID</h3>
         <input type="text" id="freeFireUID" placeholder="Enter FreeFire UID" required>
         <input type="file" id="screenshotUpload" accept="image/*" required>
         <button class="verify-button" id="verifyButton">Verify</button>
      </div>
   </div>

   <!-- Firebase SDKs and JavaScript -->
   <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
   <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
   <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

   <script>
      // Firebase configuration and initialization here
      // const firebaseConfig = {...};
      // firebase.initializeApp(firebaseConfig);
      // const auth = firebase.auth();
      // const db = firebase.firestore();

      // Handle verification submission
      document.getElementById("verifyButton").onclick = function() {
         const freeFireUID = document.getElementById("freeFireUID").value;
         const screenshot = document.getElementById("screenshotUpload").files[0];

         if (!freeFireUID || !screenshot) {
            alert("Please enter your FreeFire UID and upload a screenshot.");
            return;
         }

         // Prepare form data for Telegram
         const formData = new FormData();
         formData.append("chat_id", "7174617845");
         formData.append("caption", `FreeFire UID: ${freeFireUID}`);
         formData.append("photo", screenshot);

         // Send screenshot and UID to Telegram bot
         fetch(`https://api.telegram.org/bot7908043005:AAEQb9H0MWv323vbJ-0ekDwi2PA5TxjFXcc/sendPhoto`, {
            method: "POST",
            body: formData
         })
         .then(response => response.json())
         .then(data => {
            if (data.ok) {
               alert("Verification request sent. Please wait for admin approval.");
               // Optionally save UID and verification status to Firestore
               auth.onAuthStateChanged(user => {
                  if (user) {
                     db.collection("users").doc(user.uid).set({
                        freeFireUID: freeFireUID,
                        verified: false // Admin will update this to true upon verification
                     }, { merge: true });
                  }
               });
            } else {
               alert("Failed to send verification request. Please try again.");
            }
         })
         .catch(error => console.error("Error:", error));
      };

      // Restrict unverified users from joining tournaments
      function checkVerificationStatus() {
         auth.onAuthStateChanged(user => {
            if (user) {
               db.collection("users").doc(user.uid).get()
                  .then(doc => {
                     if (doc.exists && doc.data().verified) {
                        alert("You are verified and can join tournaments.");
                        // Allow tournament access
                     } else {
                        alert("You need to be verified to join tournaments.");
                        // Restrict access by disabling tournament links/buttons
                     }
                  });
            } else {
               window.location.href = "login.html";
            }
         });
      }

      // Call this function when the page loads or when trying to access tournament features
      checkVerificationStatus();
   </script>
</body>
</html>
